  <p> After Karma Trader from Level 4 was hit with massive karma
  inflation (purportedly due to someone flooding the market with massive
  quantities of karma), the site had to close its doors. All hope was
  not lost, however, since the technology was acquired by a real
  up-and-comer, Streamer. Streamer is the self-proclaimed most
  steamlined way of sharing updates with your friends. You can access
  your Streamer instance here: <b><a target="_blank" href="{{location}}:{{baseport + level}}">{{location}}:{{baseport + level}}</a></b> </p>

  <p> The Streamer engineers, realizing that security holes had led to
  the demise of Karma Trader, have greatly beefed up the security of
  their application. Which is really too bad, because you've learned
  that the holder of the password to access Level 7,
  <strong>level07-password-holder</strong>, is the first Streamer
  user. </p>

  <p> As well, <strong>level07-password-holder</strong> is taking a lot
  of precautions: his or her computer has no network access besides the
  Streamer server itself, and his or her password is a complicated mess,
  including quotes and apostrophes and the like. </p>

  <p> Fortunately for you, the Streamer engineers have decided to
  open-source their application so that other people can run their own
  Streamer instances. You can obtain the source for Streamer at <code>git clone https://github.com/stripe-ctf/stripe-ctf-2.0/tree/master/levels/{{level}}</code>. We've also included the most important files
  below. </p>

  <p> The contents of <code>srv.rb</code>:</p>
{% raw %}
  <code>
  <table class="CodeRay"><tbody><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == &#39;&#39;) ? &#39;none&#39; : &#39;&#39; }"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
<a href="#n5" name="n5">5</a>
<a href="#n6" name="n6">6</a>
<a href="#n7" name="n7">7</a>
<a href="#n8" name="n8">8</a>
<a href="#n9" name="n9">9</a>
<strong><a href="#n10" name="n10">10</a></strong>
<a href="#n11" name="n11">11</a>
<a href="#n12" name="n12">12</a>
<a href="#n13" name="n13">13</a>
<a href="#n14" name="n14">14</a>
<a href="#n15" name="n15">15</a>
<a href="#n16" name="n16">16</a>
<a href="#n17" name="n17">17</a>
<a href="#n18" name="n18">18</a>
<a href="#n19" name="n19">19</a>
<strong><a href="#n20" name="n20">20</a></strong>
<a href="#n21" name="n21">21</a>
<a href="#n22" name="n22">22</a>
<a href="#n23" name="n23">23</a>
<a href="#n24" name="n24">24</a>
<a href="#n25" name="n25">25</a>
<a href="#n26" name="n26">26</a>
<a href="#n27" name="n27">27</a>
<a href="#n28" name="n28">28</a>
<a href="#n29" name="n29">29</a>
<strong><a href="#n30" name="n30">30</a></strong>
<a href="#n31" name="n31">31</a>
<a href="#n32" name="n32">32</a>
<a href="#n33" name="n33">33</a>
<a href="#n34" name="n34">34</a>
<a href="#n35" name="n35">35</a>
<a href="#n36" name="n36">36</a>
<a href="#n37" name="n37">37</a>
<a href="#n38" name="n38">38</a>
<a href="#n39" name="n39">39</a>
<strong><a href="#n40" name="n40">40</a></strong>
<a href="#n41" name="n41">41</a>
<a href="#n42" name="n42">42</a>
<a href="#n43" name="n43">43</a>
<a href="#n44" name="n44">44</a>
<a href="#n45" name="n45">45</a>
<a href="#n46" name="n46">46</a>
<a href="#n47" name="n47">47</a>
<a href="#n48" name="n48">48</a>
<a href="#n49" name="n49">49</a>
<strong><a href="#n50" name="n50">50</a></strong>
<a href="#n51" name="n51">51</a>
<a href="#n52" name="n52">52</a>
<a href="#n53" name="n53">53</a>
<a href="#n54" name="n54">54</a>
<a href="#n55" name="n55">55</a>
<a href="#n56" name="n56">56</a>
<a href="#n57" name="n57">57</a>
<a href="#n58" name="n58">58</a>
<a href="#n59" name="n59">59</a>
<strong><a href="#n60" name="n60">60</a></strong>
<a href="#n61" name="n61">61</a>
<a href="#n62" name="n62">62</a>
<a href="#n63" name="n63">63</a>
<a href="#n64" name="n64">64</a>
<a href="#n65" name="n65">65</a>
<a href="#n66" name="n66">66</a>
<a href="#n67" name="n67">67</a>
<a href="#n68" name="n68">68</a>
<a href="#n69" name="n69">69</a>
<strong><a href="#n70" name="n70">70</a></strong>
<a href="#n71" name="n71">71</a>
<a href="#n72" name="n72">72</a>
<a href="#n73" name="n73">73</a>
<a href="#n74" name="n74">74</a>
<a href="#n75" name="n75">75</a>
<a href="#n76" name="n76">76</a>
<a href="#n77" name="n77">77</a>
<a href="#n78" name="n78">78</a>
<a href="#n79" name="n79">79</a>
<strong><a href="#n80" name="n80">80</a></strong>
<a href="#n81" name="n81">81</a>
<a href="#n82" name="n82">82</a>
<a href="#n83" name="n83">83</a>
<a href="#n84" name="n84">84</a>
<a href="#n85" name="n85">85</a>
<a href="#n86" name="n86">86</a>
<a href="#n87" name="n87">87</a>
<a href="#n88" name="n88">88</a>
<a href="#n89" name="n89">89</a>
<strong><a href="#n90" name="n90">90</a></strong>
<a href="#n91" name="n91">91</a>
<a href="#n92" name="n92">92</a>
<a href="#n93" name="n93">93</a>
<a href="#n94" name="n94">94</a>
<a href="#n95" name="n95">95</a>
<a href="#n96" name="n96">96</a>
<a href="#n97" name="n97">97</a>
<a href="#n98" name="n98">98</a>
<a href="#n99" name="n99">99</a>
<strong><a href="#n100" name="n100">100</a></strong>
<a href="#n101" name="n101">101</a>
<a href="#n102" name="n102">102</a>
<a href="#n103" name="n103">103</a>
<a href="#n104" name="n104">104</a>
<a href="#n105" name="n105">105</a>
<a href="#n106" name="n106">106</a>
<a href="#n107" name="n107">107</a>
<a href="#n108" name="n108">108</a>
<a href="#n109" name="n109">109</a>
<strong><a href="#n110" name="n110">110</a></strong>
<a href="#n111" name="n111">111</a>
<a href="#n112" name="n112">112</a>
<a href="#n113" name="n113">113</a>
<a href="#n114" name="n114">114</a>
<a href="#n115" name="n115">115</a>
<a href="#n116" name="n116">116</a>
<a href="#n117" name="n117">117</a>
<a href="#n118" name="n118">118</a>
<a href="#n119" name="n119">119</a>
<strong><a href="#n120" name="n120">120</a></strong>
<a href="#n121" name="n121">121</a>
<a href="#n122" name="n122">122</a>
<a href="#n123" name="n123">123</a>
<a href="#n124" name="n124">124</a>
<a href="#n125" name="n125">125</a>
<a href="#n126" name="n126">126</a>
<a href="#n127" name="n127">127</a>
<a href="#n128" name="n128">128</a>
<a href="#n129" name="n129">129</a>
<strong><a href="#n130" name="n130">130</a></strong>
<a href="#n131" name="n131">131</a>
<a href="#n132" name="n132">132</a>
<a href="#n133" name="n133">133</a>
<a href="#n134" name="n134">134</a>
<a href="#n135" name="n135">135</a>
<a href="#n136" name="n136">136</a>
<a href="#n137" name="n137">137</a>
<a href="#n138" name="n138">138</a>
<a href="#n139" name="n139">139</a>
<strong><a href="#n140" name="n140">140</a></strong>
<a href="#n141" name="n141">141</a>
<a href="#n142" name="n142">142</a>
<a href="#n143" name="n143">143</a>
<a href="#n144" name="n144">144</a>
<a href="#n145" name="n145">145</a>
<a href="#n146" name="n146">146</a>
<a href="#n147" name="n147">147</a>
<a href="#n148" name="n148">148</a>
<a href="#n149" name="n149">149</a>
<strong><a href="#n150" name="n150">150</a></strong>
<a href="#n151" name="n151">151</a>
<a href="#n152" name="n152">152</a>
<a href="#n153" name="n153">153</a>
<a href="#n154" name="n154">154</a>
<a href="#n155" name="n155">155</a>
<a href="#n156" name="n156">156</a>
<a href="#n157" name="n157">157</a>
<a href="#n158" name="n158">158</a>
<a href="#n159" name="n159">159</a>
<strong><a href="#n160" name="n160">160</a></strong>
<a href="#n161" name="n161">161</a>
<a href="#n162" name="n162">162</a>
<a href="#n163" name="n163">163</a>
<a href="#n164" name="n164">164</a>
<a href="#n165" name="n165">165</a>
<a href="#n166" name="n166">166</a>
<a href="#n167" name="n167">167</a>
<a href="#n168" name="n168">168</a>
<a href="#n169" name="n169">169</a>
<strong><a href="#n170" name="n170">170</a></strong>
<a href="#n171" name="n171">171</a>
<a href="#n172" name="n172">172</a>
<a href="#n173" name="n173">173</a>
<a href="#n174" name="n174">174</a>
<a href="#n175" name="n175">175</a>
<a href="#n176" name="n176">176</a>
<a href="#n177" name="n177">177</a>
<a href="#n178" name="n178">178</a>
<a href="#n179" name="n179">179</a>
<strong><a href="#n180" name="n180">180</a></strong>
<a href="#n181" name="n181">181</a>
<a href="#n182" name="n182">182</a>
<a href="#n183" name="n183">183</a>
<a href="#n184" name="n184">184</a>
<a href="#n185" name="n185">185</a>
<a href="#n186" name="n186">186</a>
<a href="#n187" name="n187">187</a>
<a href="#n188" name="n188">188</a>
<a href="#n189" name="n189">189</a>
<strong><a href="#n190" name="n190">190</a></strong>
<a href="#n191" name="n191">191</a>
<a href="#n192" name="n192">192</a>
<a href="#n193" name="n193">193</a>
<a href="#n194" name="n194">194</a>
<a href="#n195" name="n195">195</a>
<a href="#n196" name="n196">196</a>
<a href="#n197" name="n197">197</a>
<a href="#n198" name="n198">198</a>
<a href="#n199" name="n199">199</a>
<strong><a href="#n200" name="n200">200</a></strong>
<a href="#n201" name="n201">201</a>
<a href="#n202" name="n202">202</a>
<a href="#n203" name="n203">203</a>
<a href="#n204" name="n204">204</a>
<a href="#n205" name="n205">205</a>
<a href="#n206" name="n206">206</a>
<a href="#n207" name="n207">207</a>
<a href="#n208" name="n208">208</a>
<a href="#n209" name="n209">209</a>
<strong><a href="#n210" name="n210">210</a></strong>
<a href="#n211" name="n211">211</a>
<a href="#n212" name="n212">212</a>
<a href="#n213" name="n213">213</a>
<a href="#n214" name="n214">214</a>
<a href="#n215" name="n215">215</a>
<a href="#n216" name="n216">216</a>
<a href="#n217" name="n217">217</a>
<a href="#n218" name="n218">218</a>
<a href="#n219" name="n219">219</a>
<strong><a href="#n220" name="n220">220</a></strong>
<a href="#n221" name="n221">221</a>
<a href="#n222" name="n222">222</a>
<a href="#n223" name="n223">223</a>
<a href="#n224" name="n224">224</a>
<a href="#n225" name="n225">225</a>
<a href="#n226" name="n226">226</a>
<a href="#n227" name="n227">227</a>
<a href="#n228" name="n228">228</a>
<a href="#n229" name="n229">229</a>
<strong><a href="#n230" name="n230">230</a></strong>
<a href="#n231" name="n231">231</a>
<a href="#n232" name="n232">232</a>
<a href="#n233" name="n233">233</a>
<a href="#n234" name="n234">234</a>
<a href="#n235" name="n235">235</a>
<a href="#n236" name="n236">236</a>
<a href="#n237" name="n237">237</a>
<a href="#n238" name="n238">238</a>
<a href="#n239" name="n239">239</a>
<strong><a href="#n240" name="n240">240</a></strong>
<a href="#n241" name="n241">241</a>
<a href="#n242" name="n242">242</a>
<a href="#n243" name="n243">243</a>
<a href="#n244" name="n244">244</a>
<a href="#n245" name="n245">245</a>
<a href="#n246" name="n246">246</a>
<a href="#n247" name="n247">247</a>
<a href="#n248" name="n248">248</a>
<a href="#n249" name="n249">249</a>
<strong><a href="#n250" name="n250">250</a></strong>
<a href="#n251" name="n251">251</a>
<a href="#n252" name="n252">252</a>
<a href="#n253" name="n253">253</a>
<a href="#n254" name="n254">254</a>
<a href="#n255" name="n255">255</a>
<a href="#n256" name="n256">256</a>
<a href="#n257" name="n257">257</a>
<a href="#n258" name="n258">258</a>
<a href="#n259" name="n259">259</a>
<strong><a href="#n260" name="n260">260</a></strong>
<a href="#n261" name="n261">261</a>
<a href="#n262" name="n262">262</a>
<a href="#n263" name="n263">263</a>
<a href="#n264" name="n264">264</a>
<a href="#n265" name="n265">265</a>
<a href="#n266" name="n266">266</a>
<a href="#n267" name="n267">267</a>
</pre></td>
  <td class="code"><pre><span style="color:#34b">#!/usr/bin/env ruby</span>
require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">rubygems</span><span style="color:#710">'</span></span>
require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">bundler/setup</span><span style="color:#710">'</span></span>

require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">rack/utils</span><span style="color:#710">'</span></span>
require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">rack/csrf</span><span style="color:#710">'</span></span>
require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">json</span><span style="color:#710">'</span></span>
require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">sequel</span><span style="color:#710">'</span></span>
require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">sinatra</span><span style="color:#710">'</span></span>

<span style="color:#080;font-weight:bold">module</span> <span style="color:#B06;font-weight:bold">Streamer</span>
  <span style="color:#036;font-weight:bold">PASSWORD</span> = <span style="color:#036;font-weight:bold">File</span>.read(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">password.txt</span><span style="color:#710">'</span></span>).strip

  <span style="color:#777"># Only needed in production</span>
  <span style="color:#036;font-weight:bold">URL_ROOT</span> = <span style="color:#036;font-weight:bold">File</span>.read(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">url_root.txt</span><span style="color:#710">'</span></span>).strip <span style="color:#080;font-weight:bold">rescue</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#710">'</span></span>

  <span style="color:#080;font-weight:bold">module</span> <span style="color:#B06;font-weight:bold">DB</span>
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#069">self</span>.<span style="color:#06B;font-weight:bold">db_file</span>
      <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">streamer.db</span><span style="color:#710">'</span></span>
    <span style="color:#080;font-weight:bold">end</span>

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#069">self</span>.<span style="color:#06B;font-weight:bold">conn</span>
      <span style="color:#33B">@conn</span> ||= <span style="color:#036;font-weight:bold">Sequel</span>.sqlite(db_file)
    <span style="color:#080;font-weight:bold">end</span>

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#069">self</span>.<span style="color:#06B;font-weight:bold">safe_insert</span>(table, key_values)
      key_values.each <span style="color:#080;font-weight:bold">do</span> |key, value|
        <span style="color:#777"># Just in case people try to exfiltrate</span>
        <span style="color:#777"># level07-password-holder's password</span>
        <span style="color:#080;font-weight:bold">if</span> value.kind_of?(<span style="color:#036;font-weight:bold">String</span>) &amp;&amp;
            (value.include?(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">"</span><span style="color:#710">'</span></span>) || value.include?(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">'</span><span style="color:#710">"</span></span>))
          raise <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Value has unsafe characters</span><span style="color:#710">"</span></span>
        <span style="color:#080;font-weight:bold">end</span>
      <span style="color:#080;font-weight:bold">end</span>

      conn[table].insert(key_values)
    <span style="color:#080;font-weight:bold">end</span>

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#069">self</span>.<span style="color:#06B;font-weight:bold">init</span>
      <span style="color:#080;font-weight:bold">return</span> <span style="color:#080;font-weight:bold">if</span> <span style="color:#036;font-weight:bold">File</span>.exists?(db_file)
      <span style="color:#036;font-weight:bold">File</span>.umask(<span style="color:#00D">0066</span>)

      conn.create_table(<span style="color:#A60">:users</span>) <span style="color:#080;font-weight:bold">do</span>
        primary_key <span style="color:#A60">:id</span>
        <span style="color:#036;font-weight:bold">String</span> <span style="color:#A60">:username</span>
        <span style="color:#036;font-weight:bold">String</span> <span style="color:#A60">:password</span>
        <span style="color:#036;font-weight:bold">Time</span> <span style="color:#A60">:last_active</span>
      <span style="color:#080;font-weight:bold">end</span>

      conn.create_table(<span style="color:#A60">:posts</span>) <span style="color:#080;font-weight:bold">do</span>
        primary_id <span style="color:#A60">:id</span>
        <span style="color:#036;font-weight:bold">String</span> <span style="color:#A60">:user</span>
        <span style="color:#036;font-weight:bold">String</span> <span style="color:#A60">:title</span>
        <span style="color:#036;font-weight:bold">String</span> <span style="color:#A60">:body</span>
        <span style="color:#036;font-weight:bold">Time</span> <span style="color:#A60">:time</span>
      <span style="color:#080;font-weight:bold">end</span>

      conn[<span style="color:#A60">:users</span>].insert(<span style="color:#A60">:username</span> =&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">level07-password-holder</span><span style="color:#710">'</span></span>,
        <span style="color:#A60">:password</span> =&gt; <span style="color:#036;font-weight:bold">Streamer</span>::<span style="color:#036;font-weight:bold">PASSWORD</span>,
        <span style="color:#A60">:last_active</span> =&gt; <span style="color:#036;font-weight:bold">Time</span>.now.utc)

      conn[<span style="color:#A60">:posts</span>].insert(<span style="color:#A60">:user</span> =&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">level07-password-holder</span><span style="color:#710">'</span></span>,
        <span style="color:#A60">:title</span> =&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hello World</span><span style="color:#710">'</span></span>,
        <span style="color:#A60">:body</span> =&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Welcome to Streamer, the most streamlined way of sharing
updates with your friends!

One great feature of Streamer is that no password resets are needed. I, for
example, have a very complicated password (including apostrophes, quotes, you
name it!). But I remember it by clicking my name on the right-hand side and
seeing what my password is.

Note also that Streamer can run entirely within your corporate firewall. My
machine, for example, can only talk directly to the Streamer server itself!</span><span style="color:#710">"</span></span>,
        <span style="color:#A60">:time</span> =&gt; <span style="color:#036;font-weight:bold">Time</span>.now.utc)
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>

  <span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">StreamerSrv</span> &lt; <span style="color:#036;font-weight:bold">Sinatra</span>::<span style="color:#036;font-weight:bold">Base</span>
    set <span style="color:#A60">:environment</span>, <span style="color:#A60">:production</span>
    enable <span style="color:#A60">:sessions</span>

    <span style="color:#777"># Use persistent entropy file</span>
    entropy_file = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">entropy.dat</span><span style="color:#710">'</span></span>
    <span style="color:#080;font-weight:bold">unless</span> <span style="color:#036;font-weight:bold">File</span>.exists?(entropy_file)
      <span style="color:#036;font-weight:bold">File</span>.open(entropy_file, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">w</span><span style="color:#710">'</span></span>) <span style="color:#080;font-weight:bold">do</span> |f|
        f.write(<span style="color:#036;font-weight:bold">OpenSSL</span>::<span style="color:#036;font-weight:bold">Random</span>.random_bytes(<span style="color:#00D">24</span>))
      <span style="color:#080;font-weight:bold">end</span>
    <span style="color:#080;font-weight:bold">end</span>
    set <span style="color:#A60">:session_secret</span>, <span style="color:#036;font-weight:bold">File</span>.read(entropy_file)

    use <span style="color:#036;font-weight:bold">Rack</span>::<span style="color:#036;font-weight:bold">Csrf</span>, <span style="color:#A60">:raise</span> =&gt; <span style="color:#069">true</span>

    helpers <span style="color:#080;font-weight:bold">do</span>
      <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">absolute_url</span>(path)
        <span style="color:#036;font-weight:bold">Streamer</span>::<span style="color:#036;font-weight:bold">URL_ROOT</span> + path
      <span style="color:#080;font-weight:bold">end</span>

      <span style="color:#777"># Insert an hidden tag with the anti-CSRF token into your forms.</span>
      <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">csrf_tag</span>
        <span style="color:#036;font-weight:bold">Rack</span>::<span style="color:#036;font-weight:bold">Csrf</span>.csrf_tag(env)
      <span style="color:#080;font-weight:bold">end</span>

      <span style="color:#777"># Return the anti-CSRF token</span>
      <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">csrf_token</span>
        <span style="color:#036;font-weight:bold">Rack</span>::<span style="color:#036;font-weight:bold">Csrf</span>.csrf_token(env)
      <span style="color:#080;font-weight:bold">end</span>

      <span style="color:#777"># Return the field name which will be looked for in the requests.</span>
      <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">csrf_field</span>
        <span style="color:#036;font-weight:bold">Rack</span>::<span style="color:#036;font-weight:bold">Csrf</span>.csrf_field
      <span style="color:#080;font-weight:bold">end</span>

      include <span style="color:#036;font-weight:bold">Rack</span>::<span style="color:#036;font-weight:bold">Utils</span>
      alias_method <span style="color:#A60">:h</span>, <span style="color:#A60">:escape_html</span>
    <span style="color:#080;font-weight:bold">end</span>

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">redirect</span>(url)
      <span style="color:#080;font-weight:bold">super</span>(absolute_url(url))
    <span style="color:#080;font-weight:bold">end</span>

    before <span style="color:#080;font-weight:bold">do</span>
      <span style="color:#33B">@user</span> = logged_in_user
      update_last_active
    <span style="color:#080;font-weight:bold">end</span>

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">logged_in_user</span>
      <span style="color:#080;font-weight:bold">if</span> session[<span style="color:#A60">:user</span>]
        <span style="color:#33B">@username</span> = session[<span style="color:#A60">:user</span>]
        <span style="color:#33B">@user</span> = <span style="color:#036;font-weight:bold">DB</span>.conn[<span style="color:#A60">:users</span>][<span style="color:#A60">:username</span> =&gt; <span style="color:#33B">@username</span>]
      <span style="color:#080;font-weight:bold">end</span>
    <span style="color:#080;font-weight:bold">end</span>

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">update_last_active</span>
      <span style="color:#080;font-weight:bold">return</span> <span style="color:#080;font-weight:bold">unless</span> <span style="color:#33B">@user</span>
      <span style="color:#036;font-weight:bold">DB</span>.conn[<span style="color:#A60">:users</span>].where(<span style="color:#A60">:username</span> =&gt; <span style="color:#33B">@user</span>[<span style="color:#A60">:username</span>]).
        update(<span style="color:#A60">:last_active</span> =&gt; <span style="color:#036;font-weight:bold">Time</span>.now.utc)
    <span style="color:#080;font-weight:bold">end</span>

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">recent_posts</span>
      <span style="color:#777"># Grab the 5 most recent posts</span>
      <span style="color:#036;font-weight:bold">DB</span>.conn[<span style="color:#A60">:posts</span>].reverse_order(<span style="color:#A60">:time</span>).limit(<span style="color:#00D">5</span>).to_a.reverse
    <span style="color:#080;font-weight:bold">end</span>

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">registered_users</span>
      <span style="color:#036;font-weight:bold">DB</span>.conn[<span style="color:#A60">:users</span>].reverse_order(<span style="color:#A60">:id</span>)
    <span style="color:#080;font-weight:bold">end</span>

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">die</span>(msg, view)
      <span style="color:#33B">@error</span> = msg
      halt(erb(view))
    <span style="color:#080;font-weight:bold">end</span>

    get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
      <span style="color:#080;font-weight:bold">if</span> <span style="color:#33B">@user</span>
        <span style="color:#33B">@registered_users</span> = registered_users
        <span style="color:#33B">@posts</span> = recent_posts

        erb <span style="color:#A60">:home</span>
      <span style="color:#080;font-weight:bold">else</span>
        erb <span style="color:#A60">:login</span>
      <span style="color:#080;font-weight:bold">end</span>
    <span style="color:#080;font-weight:bold">end</span>

    get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/register</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
      erb <span style="color:#A60">:register</span>
    <span style="color:#080;font-weight:bold">end</span>

    post <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/register</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
      username = params[<span style="color:#A60">:username</span>]
      password = params[<span style="color:#A60">:password</span>]
      <span style="color:#080;font-weight:bold">unless</span> username &amp;&amp; password
        die(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Please specify both a username and a password.</span><span style="color:#710">"</span></span>, <span style="color:#A60">:register</span>)
      <span style="color:#080;font-weight:bold">end</span>

      <span style="color:#080;font-weight:bold">unless</span> <span style="color:#036;font-weight:bold">DB</span>.conn[<span style="color:#A60">:users</span>].where(<span style="color:#A60">:username</span> =&gt; username).count == <span style="color:#00D">0</span>
        die(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">This username is already registered. Try another one.</span><span style="color:#710">"</span></span>,
            <span style="color:#A60">:register</span>)
      <span style="color:#080;font-weight:bold">end</span>

      <span style="color:#036;font-weight:bold">DB</span>.safe_insert(<span style="color:#A60">:users</span>,
        <span style="color:#A60">:username</span> =&gt; username,
        <span style="color:#A60">:password</span> =&gt; password,
        <span style="color:#A60">:last_active</span> =&gt; <span style="color:#036;font-weight:bold">Time</span>.now.utc
        )
      session[<span style="color:#A60">:user</span>] = username
      redirect <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span>
    <span style="color:#080;font-weight:bold">end</span>

    get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/login</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
      redirect <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span>
    <span style="color:#080;font-weight:bold">end</span>

    post <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/login</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
      username = params[<span style="color:#A60">:username</span>]
      password = params[<span style="color:#A60">:password</span>]
      user = <span style="color:#036;font-weight:bold">DB</span>.conn[<span style="color:#A60">:users</span>][<span style="color:#A60">:username</span> =&gt; username, <span style="color:#A60">:password</span> =&gt; password]
      <span style="color:#080;font-weight:bold">unless</span> user
        die(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Could not authenticate. Perhaps you meant to register a new</span><span style="color:#710">'</span></span> \
            <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20"> account? (See link below.)</span><span style="color:#710">'</span></span>, <span style="color:#A60">:login</span>)
      <span style="color:#080;font-weight:bold">end</span>

      session[<span style="color:#A60">:user</span>] = user[<span style="color:#A60">:username</span>]
      redirect <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span>
    <span style="color:#080;font-weight:bold">end</span>

    get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/logout</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
      session.clear
      redirect <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span>
    <span style="color:#080;font-weight:bold">end</span>

    get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/user_info</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
      <span style="color:#33B">@password</span> = <span style="color:#33B">@user</span>[<span style="color:#A60">:password</span>]

      erb <span style="color:#A60">:user_info</span>
    <span style="color:#080;font-weight:bold">end</span>

    before <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/ajax/*</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
      halt(<span style="color:#00D">403</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Must be logged in!</span><span style="color:#710">'</span></span>) <span style="color:#080;font-weight:bold">unless</span> <span style="color:#33B">@user</span>
    <span style="color:#080;font-weight:bold">end</span>

    get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/ajax/posts</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
      recent_posts.to_json
    <span style="color:#080;font-weight:bold">end</span>

    post <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/ajax/posts</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
      msg = create_post
      resp = {<span style="color:#A60">:response</span> =&gt; msg}
      resp.to_json
    <span style="color:#080;font-weight:bold">end</span>

    <span style="color:#777"># Fallback if JS breaks</span>
    get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/posts</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
      redirect <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span>
    <span style="color:#080;font-weight:bold">end</span>

    post <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/posts</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
      create_post <span style="color:#080;font-weight:bold">if</span> <span style="color:#33B">@user</span>
      redirect <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span>
    <span style="color:#080;font-weight:bold">end</span>

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">create_post</span>
      post_body = params[<span style="color:#A60">:body</span>]
      title = params[<span style="color:#A60">:title</span>] || <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">untitled</span><span style="color:#710">'</span></span>
      <span style="color:#080;font-weight:bold">if</span> post_body
        <span style="color:#036;font-weight:bold">DB</span>.safe_insert(<span style="color:#A60">:posts</span>,
          <span style="color:#A60">:user</span> =&gt; <span style="color:#33B">@user</span>[<span style="color:#A60">:username</span>],
          <span style="color:#A60">:title</span> =&gt; title,
          <span style="color:#A60">:body</span> =&gt; post_body,
          <span style="color:#A60">:time</span> =&gt; <span style="color:#036;font-weight:bold">Time</span>.now.utc
          )
        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Successfully added the post!</span><span style="color:#710">'</span></span>
      <span style="color:#080;font-weight:bold">else</span>
        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">No post body given!</span><span style="color:#710">'</span></span>
      <span style="color:#080;font-weight:bold">end</span>
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">main</span>
  <span style="color:#036;font-weight:bold">Streamer</span>::<span style="color:#036;font-weight:bold">DB</span>.init
  <span style="color:#036;font-weight:bold">Streamer</span>::<span style="color:#036;font-weight:bold">StreamerSrv</span>.run!
<span style="color:#080;font-weight:bold">end</span>

<span style="color:#080;font-weight:bold">if</span> <span style="color:#d70">$0</span> == <span style="color:#069">__FILE__</span>
  main
  exit(<span style="color:#00D">0</span>)
<span style="color:#080;font-weight:bold">end</span>
</pre></td>
</tr></tbody></table>

  </code>

  <p> The contents of <code>views/home.erb</code>:</p>

  <code>
  <table class="CodeRay"><tbody><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == &#39;&#39;) ? &#39;none&#39; : &#39;&#39; }"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
<a href="#n5" name="n5">5</a>
<a href="#n6" name="n6">6</a>
<a href="#n7" name="n7">7</a>
<a href="#n8" name="n8">8</a>
<a href="#n9" name="n9">9</a>
<strong><a href="#n10" name="n10">10</a></strong>
<a href="#n11" name="n11">11</a>
<a href="#n12" name="n12">12</a>
<a href="#n13" name="n13">13</a>
<a href="#n14" name="n14">14</a>
<a href="#n15" name="n15">15</a>
<a href="#n16" name="n16">16</a>
<a href="#n17" name="n17">17</a>
<a href="#n18" name="n18">18</a>
<a href="#n19" name="n19">19</a>
<strong><a href="#n20" name="n20">20</a></strong>
<a href="#n21" name="n21">21</a>
<a href="#n22" name="n22">22</a>
<a href="#n23" name="n23">23</a>
<a href="#n24" name="n24">24</a>
<a href="#n25" name="n25">25</a>
<a href="#n26" name="n26">26</a>
<a href="#n27" name="n27">27</a>
<a href="#n28" name="n28">28</a>
<a href="#n29" name="n29">29</a>
<strong><a href="#n30" name="n30">30</a></strong>
<a href="#n31" name="n31">31</a>
<a href="#n32" name="n32">32</a>
<a href="#n33" name="n33">33</a>
<a href="#n34" name="n34">34</a>
<a href="#n35" name="n35">35</a>
<a href="#n36" name="n36">36</a>
<a href="#n37" name="n37">37</a>
<a href="#n38" name="n38">38</a>
<a href="#n39" name="n39">39</a>
<strong><a href="#n40" name="n40">40</a></strong>
<a href="#n41" name="n41">41</a>
<a href="#n42" name="n42">42</a>
<a href="#n43" name="n43">43</a>
<a href="#n44" name="n44">44</a>
<a href="#n45" name="n45">45</a>
<a href="#n46" name="n46">46</a>
<a href="#n47" name="n47">47</a>
<a href="#n48" name="n48">48</a>
<a href="#n49" name="n49">49</a>
<strong><a href="#n50" name="n50">50</a></strong>
<a href="#n51" name="n51">51</a>
<a href="#n52" name="n52">52</a>
<a href="#n53" name="n53">53</a>
<a href="#n54" name="n54">54</a>
<a href="#n55" name="n55">55</a>
<a href="#n56" name="n56">56</a>
<a href="#n57" name="n57">57</a>
<a href="#n58" name="n58">58</a>
<a href="#n59" name="n59">59</a>
<strong><a href="#n60" name="n60">60</a></strong>
<a href="#n61" name="n61">61</a>
<a href="#n62" name="n62">62</a>
<a href="#n63" name="n63">63</a>
<a href="#n64" name="n64">64</a>
<a href="#n65" name="n65">65</a>
<a href="#n66" name="n66">66</a>
<a href="#n67" name="n67">67</a>
<a href="#n68" name="n68">68</a>
<a href="#n69" name="n69">69</a>
<strong><a href="#n70" name="n70">70</a></strong>
<a href="#n71" name="n71">71</a>
<a href="#n72" name="n72">72</a>
<a href="#n73" name="n73">73</a>
<a href="#n74" name="n74">74</a>
<a href="#n75" name="n75">75</a>
<a href="#n76" name="n76">76</a>
<a href="#n77" name="n77">77</a>
<a href="#n78" name="n78">78</a>
<a href="#n79" name="n79">79</a>
<strong><a href="#n80" name="n80">80</a></strong>
<a href="#n81" name="n81">81</a>
<a href="#n82" name="n82">82</a>
<a href="#n83" name="n83">83</a>
<a href="#n84" name="n84">84</a>
<a href="#n85" name="n85">85</a>
<a href="#n86" name="n86">86</a>
<a href="#n87" name="n87">87</a>
<a href="#n88" name="n88">88</a>
<a href="#n89" name="n89">89</a>
<strong><a href="#n90" name="n90">90</a></strong>
<a href="#n91" name="n91">91</a>
<a href="#n92" name="n92">92</a>
<a href="#n93" name="n93">93</a>
<a href="#n94" name="n94">94</a>
<a href="#n95" name="n95">95</a>
<a href="#n96" name="n96">96</a>
<a href="#n97" name="n97">97</a>
<a href="#n98" name="n98">98</a>
<a href="#n99" name="n99">99</a>
<strong><a href="#n100" name="n100">100</a></strong>
<a href="#n101" name="n101">101</a>
<a href="#n102" name="n102">102</a>
<a href="#n103" name="n103">103</a>
<a href="#n104" name="n104">104</a>
<a href="#n105" name="n105">105</a>
<a href="#n106" name="n106">106</a>
</pre></td>
  <td class="code"><pre><span style="color:#070">&lt;div</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">row</span><span style="color:#710">'</span></span><span style="color:#070">&gt;</span>
  <span style="color:#070">&lt;div</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">span9</span><span style="color:#710">'</span></span><span style="color:#070">&gt;</span>
    <span style="color:#070">&lt;h3&gt;</span>Stream of Posts<span style="color:#070">&lt;/h3&gt;</span>

    <span style="color:#070">&lt;table</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">posts</span><span style="color:#710">'</span></span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">table table-bordered table-condensed</span><span style="color:#710">'</span></span><span style="color:#070">&gt;</span>
      <span style="color:#070">&lt;tbody&gt;</span>
      <span style="color:#070">&lt;/tbody&gt;</span>
    <span style="color:#070">&lt;/table&gt;</span>

    <span style="color:#070">&lt;script&gt;</span>
<span style="background-color:hsla(0,0%,0%,0.07);color:black">      <span style="color:#080;font-weight:bold">var</span> username = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">&lt;%= @username %&gt;</span><span style="color:#710">"</span></span>;
      <span style="color:#080;font-weight:bold">var</span> post_data = &lt;%= <span style="color:#F00;background-color:#FAA">@</span>posts.to_json %&gt;;

      <span style="color:#080;font-weight:bold">function</span> <span style="color:#06B;font-weight:bold">escapeHTML</span>(val) {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#369;font-weight:bold">$</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&lt;div/&gt;</span><span style="color:#710">'</span></span>).text(val).html();
      }
      <span style="color:#080;font-weight:bold">function</span> <span style="color:#06B;font-weight:bold">addPost</span>(item) {
        <span style="color:#080;font-weight:bold">var</span> new_element = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&lt;tr&gt;&lt;th&gt;</span><span style="color:#710">'</span></span> + escapeHTML(item[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">user</span><span style="color:#710">'</span></span>]) +
            <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&lt;/th&gt;&lt;td&gt;&lt;h4&gt;</span><span style="color:#710">'</span></span> + escapeHTML(item[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">title</span><span style="color:#710">'</span></span>]) + <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&lt;/h4&gt;</span><span style="color:#710">'</span></span> +
            escapeHTML(item[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">body</span><span style="color:#710">'</span></span>]) + <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&lt;/td&gt;&lt;/tr&gt;</span><span style="color:#710">'</span></span>;
        <span style="color:#369;font-weight:bold">$</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">#posts &gt; tbody:last</span><span style="color:#710">'</span></span>).prepend(new_element);
      }

      <span style="color:#080;font-weight:bold">for</span>(<span style="color:#080;font-weight:bold">var</span> i = <span style="color:#00D">0</span>; i &lt; post_data.length; i++) {
        <span style="color:#080;font-weight:bold">var</span> item = post_data[i];
        addPost(item);
      };</span>
    <span style="color:#070">&lt;/script&gt;</span>

    <span style="color:#070">&lt;form</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">new_post</span><span style="color:#710">'</span></span> <span style="color:#b48">name</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">new_post</span><span style="color:#710">'</span></span> <span style="color:#b48">action</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&lt;%= absolute_url("/posts") %</span></span><span style="color:#F00;background-color:#FAA">&gt;</span>'
          method='POST'<span style="color:#F00;background-color:#FAA">&gt;</span>
      <span style="color:#F00;background-color:#FAA">&lt;</span>%= csrf_tag %<span style="color:#F00;background-color:#FAA">&gt;</span>
      <span style="color:#070">&lt;fieldset&gt;</span>
        <span style="color:#070">&lt;div</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">control-group</span><span style="color:#710">'</span></span><span style="color:#070">&gt;</span>
          <span style="color:#070">&lt;label</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">control-label</span><span style="color:#710">'</span></span> <span style="color:#b48">for</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">title</span><span style="color:#710">'</span></span><span style="color:#070">&gt;</span>Title:<span style="color:#070">&lt;/label&gt;</span>
          <span style="color:#070">&lt;div</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">controls</span><span style="color:#710">'</span></span><span style="color:#070">&gt;</span>
            <span style="color:#070">&lt;input</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">input-medium</span><span style="color:#710">'</span></span> <span style="color:#b48">name</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">title</span><span style="color:#710">'</span></span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">title</span><span style="color:#710">'</span></span> <span style="color:#b48">type</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">text</span><span style="color:#710">'</span></span><span style="color:#070">/&gt;</span>
          <span style="color:#070">&lt;/div&gt;</span>
        <span style="color:#070">&lt;/div&gt;</span>
        <span style="color:#070">&lt;div</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">control-group</span><span style="color:#710">'</span></span><span style="color:#070">&gt;</span>
          <span style="color:#070">&lt;label</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">control-label</span><span style="color:#710">'</span></span> <span style="color:#b48">for</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">content</span><span style="color:#710">'</span></span><span style="color:#070">&gt;</span>Content:<span style="color:#070">&lt;/label&gt;</span>
          <span style="color:#070">&lt;div</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">controls</span><span style="color:#710">'</span></span><span style="color:#070">&gt;</span>
            <span style="color:#070">&lt;textarea</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">input-xlarge</span><span style="color:#710">'</span></span> <span style="color:#b48">name</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">body</span><span style="color:#710">'</span></span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">content</span><span style="color:#710">'</span></span>
              <span style="color:#b48">type</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">text</span><span style="color:#710">'</span></span><span style="color:#070">&gt;</span>Your post here...<span style="color:#070">&lt;/textarea&gt;</span>
          <span style="color:#070">&lt;/div&gt;</span>
        <span style="color:#070">&lt;/div&gt;</span>
        <span style="color:#070">&lt;div</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">form-actions</span><span style="color:#710">'</span></span><span style="color:#070">&gt;</span>
          <span style="color:#070">&lt;input</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">btn btn-primary</span><span style="color:#710">'</span></span> <span style="color:#b48">type</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">submit</span><span style="color:#710">'</span></span> <span style="color:#b48">value</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Post</span><span style="color:#710">'</span></span><span style="color:#070">/&gt;</span>
        <span style="color:#070">&lt;/div&gt;</span>
        <span style="color:#070">&lt;div</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">status</span><span style="color:#710">'</span></span> <span style="color:#b48">name</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">status</span><span style="color:#710">'</span></span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">alert alert-info</span><span style="color:#710">"</span></span><span style="color:#070">&gt;</span>
          Ready and waiting!
        <span style="color:#070">&lt;/div&gt;</span>
      <span style="color:#070">&lt;/fieldset&gt;</span>
    <span style="color:#070">&lt;/form&gt;</span>

    <span style="color:#070">&lt;script&gt;</span>
<span style="background-color:hsla(0,0%,0%,0.07);color:black">      <span style="color:#369;font-weight:bold">$</span>(document).ready(<span style="color:#080;font-weight:bold">function</span>() {
        <span style="color:#369;font-weight:bold">$</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">#new_post</span><span style="color:#710">'</span></span>).submit(<span style="color:#080;font-weight:bold">function</span>(e) {
          <span style="color:#080;font-weight:bold">var</span> new_post_data = {
            <span style="color:#606">title</span>: <span style="color:#369;font-weight:bold">$</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">#title</span><span style="color:#710">"</span></span>).val(),
            <span style="color:#606">body</span>: <span style="color:#369;font-weight:bold">$</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">#content</span><span style="color:#710">"</span></span>).val(),
            &lt;%= csrf_field %&gt;: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">&lt;%= csrf_token %&gt;</span><span style="color:#710">"</span></span>
          };
          <span style="color:#369;font-weight:bold">$</span>.post(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&lt;%= absolute_url("/ajax/posts") %&gt;</span><span style="color:#710">'</span></span>,
                 new_post_data,
                 <span style="color:#080;font-weight:bold">function</span>(data) {
            <span style="color:#080;font-weight:bold">var</span> status_text = <span style="color:#369;font-weight:bold">$</span>.parseJSON(data);
            <span style="color:#369;font-weight:bold">$</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">#status</span><span style="color:#710">'</span></span>).html(status_text[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">response</span><span style="color:#710">'</span></span>]);

            new_post_data[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">user</span><span style="color:#710">'</span></span>] = username;
            addPost(new_post_data);
          });

          e.preventDefault();
          <span style="color:#080;font-weight:bold">return</span> <span style="color:#069">false</span>;
        });
      });</span>
    <span style="color:#070">&lt;/script&gt;</span>
  <span style="color:#070">&lt;/div&gt;</span>
  <span style="color:#070">&lt;div</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">span3</span><span style="color:#710">'</span></span><span style="color:#070">&gt;</span>
    <span style="color:#070">&lt;h3&gt;</span>Users Online<span style="color:#070">&lt;/h3&gt;</span>
    <span style="color:#070">&lt;table</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">table table-condensed</span><span style="color:#710">'</span></span><span style="color:#070">&gt;</span>
      <span style="color:#F00;background-color:#FAA">&lt;</span>% @registered_users.each do |user| %<span style="color:#F00;background-color:#FAA">&gt;</span>
        <span style="color:#070">&lt;tr&gt;</span>
          <span style="color:#070">&lt;td&gt;</span>
            <span style="color:#F00;background-color:#FAA">&lt;</span>% if @username == user[:username] %<span style="color:#F00;background-color:#FAA">&gt;</span>
              <span style="color:#070">&lt;em&gt;</span>
                <span style="color:#070">&lt;a</span> <span style="color:#b48">href</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&lt;%= absolute_url("/user_info") %</span></span><span style="color:#F00;background-color:#FAA">&gt;</span>' target='_blank'<span style="color:#F00;background-color:#FAA">&gt;</span>
                  <span style="color:#F00;background-color:#FAA">&lt;</span>%=h user[:username] %<span style="color:#F00;background-color:#FAA">&gt;</span> (me)i
                <span style="color:#070">&lt;/a&gt;</span>
              <span style="color:#070">&lt;/em&gt;</span>
            <span style="color:#F00;background-color:#FAA">&lt;</span>% else %<span style="color:#F00;background-color:#FAA">&gt;</span>
              <span style="color:#F00;background-color:#FAA">&lt;</span>%=h user[:username] %<span style="color:#F00;background-color:#FAA">&gt;</span>
            <span style="color:#F00;background-color:#FAA">&lt;</span>% end %<span style="color:#F00;background-color:#FAA">&gt;</span>

            <span style="color:#070">&lt;br</span> <span style="color:#070">/&gt;</span>

            <span style="color:#070">&lt;span</span> <span style="color:#b48">style</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">font-size:10px</span><span style="color:#710">"</span></span><span style="color:#070">&gt;</span>
              Last active: <span style="color:#F00;background-color:#FAA">&lt;</span>%= user[:last_active].strftime('%H:%M:%S UTC') %<span style="color:#F00;background-color:#FAA">&gt;</span>
            <span style="color:#070">&lt;/span&gt;</span>
          <span style="color:#070">&lt;/td&gt;</span>
        <span style="color:#070">&lt;/tr&gt;</span>
      <span style="color:#F00;background-color:#FAA">&lt;</span>% end %<span style="color:#F00;background-color:#FAA">&gt;</span>
    <span style="color:#070">&lt;/table&gt;</span>
  <span style="color:#070">&lt;/div&gt;</span>
<span style="color:#070">&lt;/div&gt;</span>
</pre></td>
</tr></tbody></table>

  </code>

  <p> The contents of <code>views/login.erb</code>:</p>

  <code>
  <table class="CodeRay"><tbody><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == &#39;&#39;) ? &#39;none&#39; : &#39;&#39; }"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
<a href="#n5" name="n5">5</a>
<a href="#n6" name="n6">6</a>
<a href="#n7" name="n7">7</a>
<a href="#n8" name="n8">8</a>
<a href="#n9" name="n9">9</a>
<strong><a href="#n10" name="n10">10</a></strong>
<a href="#n11" name="n11">11</a>
<a href="#n12" name="n12">12</a>
<a href="#n13" name="n13">13</a>
<a href="#n14" name="n14">14</a>
<a href="#n15" name="n15">15</a>
<a href="#n16" name="n16">16</a>
<a href="#n17" name="n17">17</a>
<a href="#n18" name="n18">18</a>
<a href="#n19" name="n19">19</a>
<strong><a href="#n20" name="n20">20</a></strong>
<a href="#n21" name="n21">21</a>
<a href="#n22" name="n22">22</a>
<a href="#n23" name="n23">23</a>
<a href="#n24" name="n24">24</a>
<a href="#n25" name="n25">25</a>
</pre></td>
  <td class="code"><pre><span style="color:#070">&lt;div</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">row</span><span style="color:#710">'</span></span><span style="color:#070">&gt;</span>
  <span style="color:#070">&lt;div</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">span12</span><span style="color:#710">'</span></span><span style="color:#070">&gt;</span>
    <span style="color:#070">&lt;h3&gt;</span>Login<span style="color:#070">&lt;/h3&gt;</span>

    <span style="color:#070">&lt;br</span> <span style="color:#070">/&gt;</span>

    <span style="color:#070">&lt;p&gt;</span>
      Sign into your Streamer account, and instantly start sharing updates
      with your friends. If you don't have an account yet,
      <span style="color:#070">&lt;a</span> <span style="color:#b48">href</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&lt;%= absolute_url ("/register") %</span></span><span style="color:#F00;background-color:#FAA">&gt;</span>'<span style="color:#F00;background-color:#FAA">&gt;</span>create one now<span style="color:#070">&lt;/a&gt;</span>!
    <span style="color:#070">&lt;/p&gt;</span>

    <span style="color:#070">&lt;br</span> <span style="color:#070">/&gt;</span>

    <span style="color:#070">&lt;form</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">form-inline</span><span style="color:#710">'</span></span> <span style="color:#b48">action</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&lt;%= absolute_url("/login") %</span></span><span style="color:#F00;background-color:#FAA">&gt;</span>'
          method='post'<span style="color:#F00;background-color:#FAA">&gt;</span>
      <span style="color:#F00;background-color:#FAA">&lt;</span>%= csrf_tag %<span style="color:#F00;background-color:#FAA">&gt;</span>
      <span style="color:#070">&lt;input</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">input-medium</span><span style="color:#710">'</span></span> <span style="color:#b48">name</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">username</span><span style="color:#710">'</span></span> <span style="color:#b48">type</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">text</span><span style="color:#710">'</span></span>
             <span style="color:#b48">placeholder</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Username</span><span style="color:#710">'</span></span><span style="color:#070">/&gt;</span>
      <span style="color:#070">&lt;input</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">input-medium</span><span style="color:#710">'</span></span> <span style="color:#b48">name</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">password</span><span style="color:#710">'</span></span> <span style="color:#b48">type</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">password</span><span style="color:#710">'</span></span>
             <span style="color:#b48">placeholder</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Password</span><span style="color:#710">'</span></span><span style="color:#070">/&gt;</span>
      <span style="color:#070">&lt;input</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">btn btn-primary</span><span style="color:#710">'</span></span> <span style="color:#b48">type</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">submit</span><span style="color:#710">'</span></span> <span style="color:#b48">value</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Sign In</span><span style="color:#710">'</span></span><span style="color:#070">/&gt;</span>
    <span style="color:#070">&lt;/form&gt;</span>
  <span style="color:#070">&lt;/div&gt;</span>
<span style="color:#070">&lt;/div&gt;</span>
</pre></td>
</tr></tbody></table>

  </code>

  <p> The contents of <code>views/register.erb</code>:</p>

  <code>
  <table class="CodeRay"><tbody><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == &#39;&#39;) ? &#39;none&#39; : &#39;&#39; }"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
<a href="#n5" name="n5">5</a>
<a href="#n6" name="n6">6</a>
<a href="#n7" name="n7">7</a>
<a href="#n8" name="n8">8</a>
<a href="#n9" name="n9">9</a>
<strong><a href="#n10" name="n10">10</a></strong>
<a href="#n11" name="n11">11</a>
<a href="#n12" name="n12">12</a>
<a href="#n13" name="n13">13</a>
<a href="#n14" name="n14">14</a>
<a href="#n15" name="n15">15</a>
<a href="#n16" name="n16">16</a>
<a href="#n17" name="n17">17</a>
<a href="#n18" name="n18">18</a>
<a href="#n19" name="n19">19</a>
<strong><a href="#n20" name="n20">20</a></strong>
<a href="#n21" name="n21">21</a>
<a href="#n22" name="n22">22</a>
<a href="#n23" name="n23">23</a>
<a href="#n24" name="n24">24</a>
<a href="#n25" name="n25">25</a>
<a href="#n26" name="n26">26</a>
<a href="#n27" name="n27">27</a>
<a href="#n28" name="n28">28</a>
<a href="#n29" name="n29">29</a>
<strong><a href="#n30" name="n30">30</a></strong>
<a href="#n31" name="n31">31</a>
</pre></td>
  <td class="code"><pre><span style="color:#070">&lt;div</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">row</span><span style="color:#710">'</span></span><span style="color:#070">&gt;</span>
  <span style="color:#070">&lt;div</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">span12</span><span style="color:#710">'</span></span><span style="color:#070">&gt;</span>
    <span style="color:#070">&lt;h3&gt;</span>Register for a Streamer account<span style="color:#070">&lt;/h3&gt;</span>

    <span style="color:#070">&lt;br</span> <span style="color:#070">/&gt;</span>

    <span style="color:#070">&lt;form</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">form-horizontal</span><span style="color:#710">'</span></span> <span style="color:#b48">action</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&lt;%= absolute_url("/register") %</span></span><span style="color:#F00;background-color:#FAA">&gt;</span>'
          method='post'<span style="color:#F00;background-color:#FAA">&gt;</span>
      <span style="color:#F00;background-color:#FAA">&lt;</span>%= csrf_tag %<span style="color:#F00;background-color:#FAA">&gt;</span>
      <span style="color:#070">&lt;fieldset&gt;</span>
        <span style="color:#070">&lt;div</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">control-group</span><span style="color:#710">'</span></span><span style="color:#070">&gt;</span>
          <span style="color:#070">&lt;label</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">control-label</span><span style="color:#710">'</span></span> <span style="color:#b48">for</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">username</span><span style="color:#710">'</span></span><span style="color:#070">&gt;</span>Username:<span style="color:#070">&lt;/label&gt;</span>
          <span style="color:#070">&lt;div</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">controls</span><span style="color:#710">'</span></span><span style="color:#070">&gt;</span>
            <span style="color:#070">&lt;input</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">input-medium</span><span style="color:#710">'</span></span> <span style="color:#b48">name</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">username</span><span style="color:#710">'</span></span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">username</span><span style="color:#710">'</span></span>
                   <span style="color:#b48">type</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">text</span><span style="color:#710">'</span></span> <span style="color:#b48">placeholder</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Username</span><span style="color:#710">'</span></span><span style="color:#070">/&gt;</span>
          <span style="color:#070">&lt;/div&gt;</span>
        <span style="color:#070">&lt;/div&gt;</span>
        <span style="color:#070">&lt;div</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">control-group</span><span style="color:#710">'</span></span><span style="color:#070">&gt;</span>
          <span style="color:#070">&lt;label</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">control-label</span><span style="color:#710">'</span></span> <span style="color:#b48">for</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">username</span><span style="color:#710">'</span></span><span style="color:#070">&gt;</span>Password:<span style="color:#070">&lt;/label&gt;</span>
          <span style="color:#070">&lt;div</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">controls</span><span style="color:#710">'</span></span><span style="color:#070">&gt;</span>
            <span style="color:#070">&lt;input</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">input-medium</span><span style="color:#710">'</span></span> <span style="color:#b48">name</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">password</span><span style="color:#710">'</span></span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">password</span><span style="color:#710">'</span></span>
                   <span style="color:#b48">type</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">password</span><span style="color:#710">'</span></span> <span style="color:#b48">placeholder</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Password</span><span style="color:#710">'</span></span><span style="color:#070">/&gt;</span>
          <span style="color:#070">&lt;/div&gt;</span>
        <span style="color:#070">&lt;/div&gt;</span>
        <span style="color:#070">&lt;div</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">form-actions</span><span style="color:#710">'</span></span><span style="color:#070">&gt;</span>
          <span style="color:#070">&lt;input</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">btn btn-primary</span><span style="color:#710">'</span></span> <span style="color:#b48">type</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">submit</span><span style="color:#710">'</span></span> <span style="color:#b48">value</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Register</span><span style="color:#710">'</span></span><span style="color:#070">/&gt;</span>
        <span style="color:#070">&lt;/div&gt;</span>
      <span style="color:#070">&lt;/fieldset&gt;</span>
    <span style="color:#070">&lt;/form&gt;</span>
  <span style="color:#070">&lt;/div&gt;</span>
<span style="color:#070">&lt;/div&gt;</span>
</pre></td>
</tr></tbody></table>

  </code>

  <p> The contents of <code>views/layout.erb</code>:</p>

  <code>
  <table class="CodeRay"><tbody><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == &#39;&#39;) ? &#39;none&#39; : &#39;&#39; }"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
<a href="#n5" name="n5">5</a>
<a href="#n6" name="n6">6</a>
<a href="#n7" name="n7">7</a>
<a href="#n8" name="n8">8</a>
<a href="#n9" name="n9">9</a>
<strong><a href="#n10" name="n10">10</a></strong>
<a href="#n11" name="n11">11</a>
<a href="#n12" name="n12">12</a>
<a href="#n13" name="n13">13</a>
<a href="#n14" name="n14">14</a>
<a href="#n15" name="n15">15</a>
<a href="#n16" name="n16">16</a>
<a href="#n17" name="n17">17</a>
<a href="#n18" name="n18">18</a>
<a href="#n19" name="n19">19</a>
<strong><a href="#n20" name="n20">20</a></strong>
<a href="#n21" name="n21">21</a>
<a href="#n22" name="n22">22</a>
<a href="#n23" name="n23">23</a>
<a href="#n24" name="n24">24</a>
<a href="#n25" name="n25">25</a>
<a href="#n26" name="n26">26</a>
<a href="#n27" name="n27">27</a>
<a href="#n28" name="n28">28</a>
<a href="#n29" name="n29">29</a>
<strong><a href="#n30" name="n30">30</a></strong>
<a href="#n31" name="n31">31</a>
<a href="#n32" name="n32">32</a>
<a href="#n33" name="n33">33</a>
</pre></td>
  <td class="code"><pre><span style="color:#F00;background-color:#FAA">&lt;</span>!doctype html<span style="color:#F00;background-color:#FAA">&gt;</span>
<span style="color:#070">&lt;html&gt;</span>
  <span style="color:#070">&lt;head&gt;</span>
    <span style="color:#070">&lt;title&gt;</span>Streamer<span style="color:#070">&lt;/title&gt;</span>
    <span style="color:#070">&lt;script</span> <span style="color:#b48">src</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&lt;%= absolute_url(</span><span style="color:#710">'</span></span><span style="color:#F00;background-color:#FAA">/</span><span style="color:#b48">js</span><span style="color:#F00;background-color:#FAA">/</span><span style="color:#b48">jquery-1.8.0.min.js</span><span style="color:#F00;background-color:#FAA">'</span><span style="color:#F00;background-color:#FAA">)</span> <span style="color:#F00;background-color:#FAA">%</span><span style="color:#070">&gt;</span>'<span style="color:#F00;background-color:#FAA">&gt;</span><span style="color:#070">&lt;/script&gt;</span>
    <span style="color:#070">&lt;link</span> <span style="color:#b48">rel</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">stylesheet</span><span style="color:#710">'</span></span> <span style="color:#b48">type</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">text/css</span><span style="color:#710">'</span></span>
          <span style="color:#b48">href</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&lt;%= absolute_url(</span><span style="color:#710">'</span></span><span style="color:#F00;background-color:#FAA">/</span><span style="color:#b48">css</span><span style="color:#F00;background-color:#FAA">/</span><span style="color:#b48">bootstrap-combined.min.css</span><span style="color:#F00;background-color:#FAA">'</span><span style="color:#F00;background-color:#FAA">)</span> <span style="color:#F00;background-color:#FAA">%</span><span style="color:#070">&gt;</span>' /<span style="color:#F00;background-color:#FAA">&gt;</span>
  <span style="color:#070">&lt;/head&gt;</span>
  <span style="color:#070">&lt;body&gt;</span>
    <span style="color:#070">&lt;div</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">navbar</span><span style="color:#710">'</span></span><span style="color:#070">&gt;</span>
      <span style="color:#070">&lt;div</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">navbar-inner</span><span style="color:#710">'</span></span><span style="color:#070">&gt;</span>
        <span style="color:#070">&lt;div</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">container</span><span style="color:#710">'</span></span><span style="color:#070">&gt;</span>
          <span style="color:#070">&lt;a</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">brand</span><span style="color:#710">'</span></span> <span style="color:#b48">href</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&lt;%= absolute_url("/") %</span></span><span style="color:#F00;background-color:#FAA">&gt;</span>'<span style="color:#F00;background-color:#FAA">&gt;</span>Streamer<span style="color:#070">&lt;/a&gt;</span>
          <span style="color:#F00;background-color:#FAA">&lt;</span>% if @user %<span style="color:#F00;background-color:#FAA">&gt;</span>
            <span style="color:#070">&lt;ul</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">nav pull-right</span><span style="color:#710">'</span></span><span style="color:#070">&gt;</span>
              <span style="color:#070">&lt;li&gt;</span><span style="color:#070">&lt;a</span> <span style="color:#b48">href</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&lt;%= absolute_url("/logout") %</span></span><span style="color:#F00;background-color:#FAA">&gt;</span>'<span style="color:#F00;background-color:#FAA">&gt;</span>Log Out<span style="color:#070">&lt;/a&gt;</span><span style="color:#070">&lt;/li&gt;</span>
            <span style="color:#070">&lt;/ul&gt;</span>
          <span style="color:#F00;background-color:#FAA">&lt;</span>% end %<span style="color:#F00;background-color:#FAA">&gt;</span>
        <span style="color:#070">&lt;/div&gt;</span>
      <span style="color:#070">&lt;/div&gt;</span>
    <span style="color:#070">&lt;/div&gt;</span>
    <span style="color:#070">&lt;div</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">container</span><span style="color:#710">'</span></span><span style="color:#070">&gt;</span>
<span style="color:#F00;background-color:#FAA">&lt;</span>% if @error %<span style="color:#F00;background-color:#FAA">&gt;</span>
  <span style="color:#070">&lt;p&gt;</span>Error: <span style="color:#F00;background-color:#FAA">&lt;</span>%= @error %<span style="color:#F00;background-color:#FAA">&gt;</span><span style="color:#070">&lt;/p&gt;</span>
<span style="color:#F00;background-color:#FAA">&lt;</span>% end %<span style="color:#F00;background-color:#FAA">&gt;</span>
<span style="color:#F00;background-color:#FAA">&lt;</span>% if @success %<span style="color:#F00;background-color:#FAA">&gt;</span>
  <span style="color:#070">&lt;p&gt;</span>Success: <span style="color:#F00;background-color:#FAA">&lt;</span>%= @success %<span style="color:#F00;background-color:#FAA">&gt;</span><span style="color:#070">&lt;/p&gt;</span>
<span style="color:#F00;background-color:#FAA">&lt;</span>% end %<span style="color:#F00;background-color:#FAA">&gt;</span>

      <span style="color:#F00;background-color:#FAA">&lt;</span>%= yield %<span style="color:#F00;background-color:#FAA">&gt;</span>
    <span style="color:#070">&lt;/div&gt;</span>
  <span style="color:#070">&lt;/body&gt;</span>
<span style="color:#070">&lt;/html&gt;</span>
</pre></td>
</tr></tbody></table>

  </code>

  <p> The contents of <code>views/user_info.erb</code>:</p>

  <code>
  <table class="CodeRay"><tbody><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == &#39;&#39;) ? &#39;none&#39; : &#39;&#39; }"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
<a href="#n5" name="n5">5</a>
<a href="#n6" name="n6">6</a>
<a href="#n7" name="n7">7</a>
<a href="#n8" name="n8">8</a>
<a href="#n9" name="n9">9</a>
<strong><a href="#n10" name="n10">10</a></strong>
<a href="#n11" name="n11">11</a>
<a href="#n12" name="n12">12</a>
<a href="#n13" name="n13">13</a>
<a href="#n14" name="n14">14</a>
<a href="#n15" name="n15">15</a>
</pre></td>
  <td class="code"><pre><span style="color:#070">&lt;div</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">row</span><span style="color:#710">'</span></span><span style="color:#070">&gt;</span>
  <span style="color:#070">&lt;div</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">span12</span><span style="color:#710">'</span></span><span style="color:#070">&gt;</span>
    <span style="color:#070">&lt;h3&gt;</span>User Information<span style="color:#070">&lt;/h3&gt;</span>
    <span style="color:#070">&lt;table</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">table table-condensed</span><span style="color:#710">'</span></span><span style="color:#070">&gt;</span>
      <span style="color:#070">&lt;tr&gt;</span>
        <span style="color:#070">&lt;th&gt;</span>Username:<span style="color:#070">&lt;/th&gt;</span>
        <span style="color:#070">&lt;td&gt;</span><span style="color:#F00;background-color:#FAA">&lt;</span>%= @username %<span style="color:#F00;background-color:#FAA">&gt;</span><span style="color:#070">&lt;/td&gt;</span>
      <span style="color:#070">&lt;/tr&gt;</span>
      <span style="color:#070">&lt;tr&gt;</span>
        <span style="color:#070">&lt;th&gt;</span>Password:<span style="color:#070">&lt;/th&gt;</span>
        <span style="color:#070">&lt;td&gt;</span><span style="color:#F00;background-color:#FAA">&lt;</span>%= @password %<span style="color:#F00;background-color:#FAA">&gt;</span><span style="color:#070">&lt;/td&gt;</span>
      <span style="color:#070">&lt;/tr&gt;</span>
    <span style="color:#070">&lt;/table&gt;</span>
  <span style="color:#070">&lt;/div&gt;</span>
<span style="color:#070">&lt;/div&gt;</span>
</pre></td>
</tr></tbody></table>

  </code>
{% endraw %}